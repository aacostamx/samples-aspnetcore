@using Okta.AspNetCore

@model OktaSignInWidgetConfiguration

@{
    var validationResult = Model.Validate();
}

@section head
{
    <script src="https://global.oktacdn.com/okta-signin-widget/@(Model.Version)/js/okta-sign-in.min.js" type="text/javascript"></script>
    <link href="https://global.oktacdn.com/okta-signin-widget/@(Model.Version)/css/okta-sign-in.min.css" type="text/css" rel="stylesheet" />
}

<div id="okta-signin-widget-container"></div>
<script type="text/javascript">
    const widgetConfig = {
        "version": "5.5.2",
        "baseUrl": "@Model.BaseUrl", 
        "clientId": "@Model.ClientId",
        "redirectUri": "@Model.RedirectUri",
        "authParams": {
            "issuer": "@Model.AuthParams.Issuer",
            "scopes": [
                "openid",
                "profile"
            ]
        },
        "useInteractionCodeFlow": true,
        "state": "@Model.State",
        "interactionHandle": "@Model.InteractionHandle",
        "codeChallenge": "@Model.CodeChallenge",
        "codeChallengeMethod": "@Model.CodeChallengeMethod"
    };
    const signIn = new OktaSignIn({
        el: '#okta-signin-widget-container',
        ...widgetConfig
    });
    signIn.showSignInAndRedirect()
        .catch(err => {
            console.log('Error happen in showSignInAndRedirect: ', err);
        });
</script>

@* Html.OktaSignInWidget renders the HTML below


*@

@if (!validationResult.Success)
{
    <div class="ui negative message">
        <div class="header">Errors:</div>
        <ul class="list">
            @foreach (string message in validationResult.Messages)
            {
            <li>@message</li>
            }
        </ul>
    </div>
}